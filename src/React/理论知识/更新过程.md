# 更新过程

有两种方式触发更新

- 应用初始化的时候，初始化渲染
- 响应用户的交互，比如点击了按钮

## setState 的两个特性

- 批量更新
- 局部更新

### 批量更新

既然是批量更新，那么就包含两个阶段

- 收集阶段。收集所有的变更
- 触发阶段。

每次 setState 都会将变更存储起来，并不是每次的变更都会生成一次渲染任务，而是通过调度器合并同一批次当中优先级相同的变更，最终生成一次渲染任务。

### 局部更新

并不是每次 setState 都会渲染整个页面，而是尽量下的区更新所需要更新的部分。

怎么识别哪个组建需要更新呢？

**打标记**。
当我们调用 setState 的时候，在当前节点上打上一个标记，并且把这个标记一层层的传递到顶部的根节点，当我们重新生成 Fiber 树的时候，就可以根据这个标记找到真正需要重新生成的 Fiber 节点，其他所有的节点都可以复用原来的，然后再去 commit 这个新的 Fiber 节点到页面上。
